---
title: "Thesis Porfolio 1"
author: "Adam"
date: "4/4/2022"
output: html_document
---

The goal of this markdown is to properly clean data using R. Admittedly I think I've decided to do all my future data cleaning in SPSS because I find it easier, but it's worth the practice. Plus I need portfolios.

## Set-up

First, I need to ensure that I have the packages needed.


library('psych')
library('reshape2')
library('dplyr')
library('Rcpp')
library('readr')
library('tidyverse')

rm(list=ls())

##### Bringing in the data

Data downloaded from Qualtrics as a .csv. Some minor cleaning (removing incompleted responses) has already been done.

```{r bringing in data, echo=FALSE}
study1 <- read_csv("~/Master's Program Wake Forest/Research/Online Belonging/Thesis Study 1/Data for Portfolio/Portfolio 1 - cleaned (pre).csv")
View(study1)
```

>For some reason, this isn't letting the file knit? It's saying the function 'read_csv' can't be found, but the file is opening and 'readr' is the package that adds that function.

Making sure it's a tibble.

as_tibble(study1)


### Checking for bad data

Checking for bad actors in the data, before giving credit.

```{r checking the basics}
summary(study1$Durationinseconds)
```

```{r Filtering}
#looking narrowly at people under the 1st quartile (172)

filter(study1, Durationinseconds < 172) %>%
        arrange(Durationinseconds)
```

I found no straight-lining within this subset, which suggests to me that the data was all given in good faith. However, I wanted to look at another subset.

I filtered for students that answered positively on two items that previous research suggest should be opposite, belonging and feeling like an outsider.

```{r}
filter(study1, school_belong > 4, school_outsider > 4)
#40 students fall into this category

filter(study1, class_belong > 4, class_outsider > 4)
#18 students fall into class.

filter(study1, school_belong > 4, school_outsider > 4, class_belong > 4, class_outsider > 4)
#4 students fall into this category. Only one seemed suspicious, but passed along to Shannon to make a decision.

```

Ultimately, we decided to grant credit to all students. That means it's time to move on to cleaning the data.


## Data cleaning

Removing identifying information from the dataset.

```{r}
study1 <- subset(study1, select= -c(StartDate, EndDate, Status,	IPAddress, Progress,
                Finished, RecordedDate, ResponseId, RecipientLastName, RecipientFirstName,
                RecipientEmail, ExternalReference, LocationLatitude, LocationLongitude,
                DistributionChannel, UserLanguage))

```

The dataset opened above actually already has these removed since I am sharing this externally from the people listed on the IRB, but this is how they were removed.


### Descriptives cleaning

Now it's time to begin creating the dummy codes needed for my analyses.

##### Gender dummy coding

First, I need to look at whether we have non-binary individuals in the dataset.

```{r checking gender demographics}
study1 %>%
        filter(is.na(demog_gender_female), is.na(demog_gender_male)) %>%
        count(demog_gender_trans, demog_gender_twospirit, demog_gender_genderqueer, demog_gender_other, demog_gender_no_answer)

study1 %>%
count(demog_gender_trans, demog_gender_twospirit, demog_gender_genderqueer, demog_gender_other, demog_gender_no_answer)

```

We have 12 people that did not identify as either male or female in some way. Due to this small number, there is not much we can do with the individual gender terms, so I am going to make two variables, gender_male & gender_nonbinary. Women serve as the reference class for the 'binary' gender dummy code.

> I may need to create the variable first and assign it as a numeric variable. Alternatively, I may need to do this after the first non-binary command to get it to work with the is.na command. Will test when I have finished and reset the workspace.



The code below creates the non-binary variable based on if someone answered yes to any of the demographic non-binary options, and a 0 if they answered to either of the binary answers. Then, the second set of code makes it so that NA answers are coded as non-binary as well.

```{r creating non-binary dummy-code}
study1 <- study1 %>%
        mutate(
        gender_nonbinary=case_when(
        !demog_gender_male & !demog_gender_female & demog_gender_twospirit | demog_gender_genderqueer | demog_gender_other
        ~ 1,
        demog_gender_female | demog_gender_male ~ 0
        ))

# This code will make it so that the NA are coded as 1. For non-binary, those without an answer will be considered non-binary.

study1 <- study1 %>%
        mutate(
        gender_nonbinary=case_when(
                gender_nonbinary == 1 ~ 1,
                gender_nonbinary == 0 ~ 0,
        is.na(gender_nonbinary) ~ 1
))
```

I spent five hours weeks ago trying to get this to work. It went so poorly I chose to make my dummy coded variables in SPSS. I'm so relieved this worked.

Below, I create the dummy code for the gender binary.

```{r Creating  binary gender dummy code}
study1 <- study1 %>%
        mutate(
        gender_male_dummy=case_when(
                demog_gender_male == 1 ~ 1,
                demog_gender_female | gender_nonbinary ~ 0
                ))
```

This code does not leave anyone NA, so there is no need to add that bit of code.

      
        
##### Race dummy coding

To create the race dummy codes, I first need to create a multiracial composite so that I can avoid adding multiracial people to individual dummy codes. 

Because the individual race codes have NA in all unfilled spots, I need to replace them with 0's to get the code to work correctly. The code is a little hideous and not consolidated, but I prefer to look and see them individually, especially because I can collapse this code in the chunk.

```{r adding 0 to original code}

study1 <- study1 %>%
        mutate(demog_race_51=case_when(
                demog_race_51 == 1 ~ 1,
                is.na(demog_race_51) ~ 0
                                       ))

study1 <- study1 %>%
        mutate(demog_race_52=case_when(
                demog_race_52 == 1 ~ 1,
                is.na(demog_race_52) ~ 0
                                       ))

study1 <- study1 %>%
        mutate(demog_race_59=case_when(
                demog_race_59 == 1 ~ 1,
                is.na(demog_race_59) ~ 0
                                       ))
study1 <- study1 %>%
        mutate(demog_race_21=case_when(
                demog_race_21 == 1 ~ 1,
                is.na(demog_race_21) ~ 0
                                       ))

study1 <- study1 %>%
        mutate(demog_race_22=case_when(
                demog_race_22 == 1 ~ 1,
                is.na(demog_race_22) ~ 0
                                       ))

study1 <- study1 %>%
        mutate(demog_race_23=case_when(
                demog_race_23 == 1 ~ 1,
                is.na(demog_race_23) ~ 0
                                       ))

study1 <- study1 %>%
        mutate(demog_race_29=case_when(
                demog_race_29 == 1 ~ 1,
                is.na(demog_race_29) ~ 0
                                       ))

study1 <- study1 %>%
        mutate(demog_race_31=case_when(
                demog_race_31 == 1 ~ 1,
                is.na(demog_race_31) ~ 0
                                       ))

study1 <- study1 %>%
        mutate(demog_race_32=case_when(
                demog_race_32 == 1 ~ 1,
                is.na(demog_race_32) ~ 0
                                       ))

study1 <- study1 %>%
        mutate(demog_race_33=case_when(
                demog_race_33 == 1 ~ 1,
                is.na(demog_race_33) ~ 0
                                       ))

study1 <- study1 %>%
        mutate(demog_race_39=case_when(
                demog_race_39 == 1 ~ 1,
                is.na(demog_race_39) ~ 0
                                       ))

study1 <- study1 %>%
        mutate(demog_race_11=case_when(
                demog_race_11 == 1 ~ 1,
                is.na(demog_race_11) ~ 0
                                       ))

study1 <- study1 %>%
        mutate(demog_race_12=case_when(
                demog_race_12 == 1 ~ 1,
                is.na(demog_race_12) ~ 0
                                       ))

study1 <- study1 %>%
        mutate(demog_race_13=case_when(
                demog_race_13 == 1 ~ 1,
                is.na(demog_race_13) ~ 0
                                       ))

study1 <- study1 %>%
        mutate(demog_race_19=case_when(
                demog_race_19 == 1 ~ 1,
                is.na(demog_race_19) ~ 0
                                       ))

study1 <- study1 %>%
        mutate(demog_race_41=case_when(
                demog_race_41 == 1 ~ 1,
                is.na(demog_race_41) ~ 0
                                       ))

study1 <- study1 %>%
        mutate(demog_race_42=case_when(
                demog_race_42 == 1 ~ 1,
                is.na(demog_race_42) ~ 0
                                       ))

study1 <- study1 %>%
        mutate(demog_race_89=case_when(
                demog_race_89 == 1 ~ 1,
                is.na(demog_race_89) ~ 0
                                       ))

study1 <- study1 %>%
        mutate(demog_race_99=case_when(
                demog_race_99 == 1 ~ 1,
                is.na(demog_race_99) ~ 0
                                       ))
```


With that task finished, we can work on making the multiracial composite.


```{r creating a multiracial sum}
study1 <- study1 %>%
        rowwise() %>%
        mutate(
                multiracial_sum=sum(c_across(demog_race_41:demog_race_89
        )))

```

```{r Creating multiracial dummy code}
study1 <- study1 %>%
        mutate(race_multiracial=case_when(
                multiracial_sum > 1 ~ 1,
                multiracial_sum == 1 ~ 0,
                multiracial_sum == 0 ~ 0
        ))

```


### Variables of Interest

Next, we need to create the composite variables for the variables of interest


##### Institutional belonging (belong_instit_comp4)


##### Class belonging (belong_class_comp4)


##### Class disclosure (cdiscl_disclose_comp3)


##### Class prompted disclosure (cdiscl__prompt_comp2)


#### Group disclosure (gdiscl_disclose_comp3)


##### Group prompted disclosure (gdiscl_prompt_comp2)


### Saving the data!

Temp example of how to do this

write.csv(df, file = "df.csv")